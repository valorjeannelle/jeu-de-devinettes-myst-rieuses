<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="icon" href="favicon-32x32.png" type="image/x-icon">
  <meta charset="UTF-8">
  <title>Jeu des Devinettes Myst√©rieuses</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
    }

    /* Brume violette */
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: radial-gradient(circle at center, rgba(128,0,128,0.15), transparent 70%);
      animation: fogMove 20s infinite linear;
      z-index: -1;
    }

    @keyframes fogMove {
      0% { transform: translateX(0); }
      50% { transform: translateX(20px); }
      100% { transform: translateX(0); }
    }

    /*  Intro anim√©e */
    #intro {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: black;
    }

    #animatedTitle span {
      display: inline-block;
      font-size: 48px;
      color: violet;
      opacity: 0;
      transform: translateY(-100px);
      animation: drop 0.6s forwards;
    }

    @keyframes drop {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #startButton, #restartButton {
      margin-top: 30px;
      padding: 10px 20px;
      font-size: 18px;
      background-color: violet;
      color: black;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Jeu principal */
    #game {
      padding-top: 80px;
      display: none;
    }

    h1 {
      color: violet;
      margin-bottom: 30px;
    }

    input[type="text"] {
      background-color: #111;
      border: 2px solid violet;
      color: white;
      padding: 10px;
      font-size: 18px;
      border-radius: 8px;
      width: 300px;
      margin-bottom: 20px;
    }

    button {
      background-color: violet;
      color: black;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    #feedback {
      margin-top: 20px;
      font-size: 18px;
    }

    #score {
      margin-top: 30px;
      font-size: 20px;
      color: gold;
    }

    /* Texte tremblant */
    .broken-text {
      display: inline-block;
      animation: shake 1.5s infinite ease-in-out;
    }

    @keyframes shake {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(1deg); }
      50% { transform: rotate(-1deg); }
      75% { transform: rotate(1deg); }
      100% { transform: rotate(0deg); }
    }
    #finalEffect {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: radial-gradient(circle, rgba(128,0,128,0.4), transparent 70%);
    animation: fadeOut 3s ease-out forwards;
    z-index: 10;
    pointer-events: none;
  }

@keyframes fadeOut {
  0% { opacity: 1; }
  100% { opacity: 0; display: none; }
}
#finalMessage {
  font-family: 'Georgia', serif;
  color: #ffccff;
  font-size: 22px;
  margin-top: 20px;
}
#scoreFinal {
  font-family: 'Georgia', serif;
  color: gold;
  font-size: 24px;
  margin-top: 10px;
}
  </style>
</head>
<body>

<!--  INTRO -->
<div id="intro">
  <h1 id="animatedTitle"></h1>
  <h2 style="color: white; margin-top: 20px;">
    Bienvenue dans <span style="color: violet;">Devine le mot myst√®re</span>
  </h2>
  <button id="startButton">Commencer</button>
</div>

<!-- JEU -->
<div id="game">
  <h1>üîÆ Devinettes Myst√©rieuses</h1>
  <p id="riddleText">Pr√©pare-toi √† deviner...</p>
  <input type="text" id="guessInput" placeholder="Ta r√©ponse ici...">
  <br>
  <button onclick="checkGuess()">Deviner</button>

  <div id="feedback"></div>
  <div id="score"></div>
  <button id="restartButton" style="display:none;" onclick="restartGame()">Rejouer</button>

  <!-- Sons -->
  <audio id="failSound" src="failure-1-89170.mp3"></audio>
  <audio id="successSound" src="success.mp3"></audio>
  <audio id="musiqueJeu" src="magic-in-the-air-43177.mp3" loop></audio>
  
</div>
<script src="devinettes.js"></script>
<script>
  // Animation du titre
  const title = "Devinettes Myst√©rieuses";
  const animatedTitle = document.getElementById("animatedTitle");



  title.split("").forEach((char, i) => {
    const span = document.createElement("span");
    span.textContent = char === " " ? "\u00A0" : char;
    span.style.animationDelay = `${i * 0.1}s`;
    animatedTitle.appendChild(span);
  });

 document.getElementById("startButton").addEventListener("click", () => {
  document.getElementById("intro").style.display = "none";
  document.getElementById("game").style.display = "block";
  document.getElementById("musiqueJeu").play().catch(() => {});
});



  // Choisir une phrase al√©atoire parmi les r√©actions
  const reactions = [
  "Le mot te regarde, mais tu ne le vois pas.",
  "Tu marches dans la brume, sans lampe ni rep√®re.",
  "Ce n‚Äôest pas √ßa... mais le myst√®re aime les errants.",
  "Tu cherches... et c‚Äôest d√©j√† une r√©ponse.",
  "Le silence t‚Äô√©coute, mais ne r√©pond pas encore."
];
  


  let currentRiddle = { riddle: "", answer: "" };
  let attempt = 0;
  let totalScore = 0;
  let maxRounds = 5;
  let roundsPlayed = 0;
  function getLocalRiddle() {
    if (devinettesLocales.length === 0) {
      return { riddle: "Plus de devinettes disponibles.", answer: "", keyword: "" };
    }
    const index = Math.floor(Math.random() * devinettesLocales.length);
    const riddle = devinettesLocales.splice(index, 1)[0];
    return {
      ...riddle,
      keyword: normalize(riddle.answer.split(" ")[0])
    };
  }
  const failSound = document.getElementById("failSound");
  const successSound = document.getElementById("successSound");
  

  function playSound(sound) {
    sound.pause();
    sound.currentTime = 0;
    sound.play().catch(() => console.log("Son non lu"));
  }

  function normalize(text) {
  return text
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "") // accents
    .replace(/^l['‚Äô]/, "") // enl√®ve "l'" ou "l‚Äô" au d√©but du mot
    .replace(/\b(le|la|les|un|une|des|du|de|d‚Äô|l‚Äô|cest|ce|mon|ma|mes|ton|ta|tes|son|sa|ses)\b/g, "") // articles
    .replace(/[^\w\s]/g, "") // ponctuation
    .replace(/\s+/g, "") // espaces
    .trim();
}

async function updateRiddle() {
  currentRiddle = getLocalRiddle();
  document.getElementById("riddleText").innerHTML = `<span class="broken-text">${currentRiddle.riddle}</span>`;
}

 updateRiddle(); // maintenant asynchrone

function checkGuess() {
  const guess = document.getElementById("guessInput").value;
  const feedback = document.getElementById("feedback");
  const scoreDisplay = document.getElementById("score");

  if (roundsPlayed >= maxRounds) {
    feedback.innerHTML = "La partie est termin√©e. Clique sur Rejouer.";
    return;
  }

  if (normalize(guess) === "") {
    feedback.innerHTML = "Tu dois entrer une r√©ponse.";
    return;
  }

  if (normalize(guess).includes(normalize(currentRiddle.answer))) {
    totalScore += 1;
    playSound(successSound);
    feedback.innerHTML = "Bravo ! Tu as perc√© le myst√®re.";
    attempt = 0;
    roundsPlayed++;

    if (roundsPlayed >= maxRounds) {
      feedback.innerHTML += `<div id="scoreFinal">Partie termin√©e ! Score final : ${totalScore} / ${maxRounds}</div>`;

      let finalMessage = "";
      if (totalScore === maxRounds) {
        finalMessage = "Tu es ma√Ætre des myst√®res !";
      } else if (totalScore >= 3) {
        finalMessage = "Tu as travers√© la brume avec bravoure.";
      } else {
        finalMessage = "Le myst√®re te r√©siste encore... mais tu reviendras.";
      }

//  Ajout du message styl√©
feedback.innerHTML += `<div id="finalMessage">${finalMessage}</div>`;

//  Ajout de l'effet visuel
const effect = document.createElement("div");
effect.id = "finalEffect";
document.body.appendChild(effect);
      document.getElementById("restartButton").style.display = "inline-block";
      document.getElementById("guessInput").disabled = true;
    } else {
      feedback.innerHTML += "<br><br>Nouveau mot √† deviner...";
      updateRiddle(); // seulement si roundsPlayed < maxRounds
    }
  } else {
    attempt++;
    if (attempt < 5) {
      feedback.innerHTML = reactions[attempt - 1];
    } else {
      playSound(failSound);
      feedback.innerHTML = "Le mot √©tait : " + currentRiddle.answer;
      attempt = 0;
      roundsPlayed++; 
      if (roundsPlayed >= maxRounds) {
  feedback.innerHTML += `<div id="scoreFinal">Partie termin√©e ! Score final : ${totalScore} / ${maxRounds}</div>`;

  let finalMessage = "";
  if (totalScore === maxRounds) {
    finalMessage = "Tu es ma√Ætre des myst√®res !";
  } else if (totalScore >= 3) {
    finalMessage = "Tu as travers√© la brume avec bravoure.";
  } else {
    finalMessage = "Le myst√®re te r√©siste encore... mais tu reviendras.";
  }

  feedback.innerHTML += `<div id="finalMessage">${finalMessage}</div>`;

  const effect = document.createElement("div");
  effect.id = "finalEffect";
  document.body.appendChild(effect);

  document.getElementById("restartButton").style.display = "inline-block";
  document.getElementById("guessInput").disabled = true;
} else {
  feedback.innerHTML += "<br><br>Nouveau mot √† deviner...";
  updateRiddle();
}

    
    }
  }
  document.getElementById("guessInput").value = "";
}

  function restartGame() {
  attempt = 0;
  totalScore = 0;
  roundsPlayed = 0;
  document.getElementById("guessInput").disabled = false;
  document.getElementById("feedback").innerHTML = "";
  document.getElementById("score").innerHTML = "";
  document.getElementById("restartButton").style.display = "none";
  document.getElementById("guessInput").value = "";
  updateRiddle();
  document.getElementById("game").scrollIntoView({ behavior: "smooth" });
}
</script>

</body>
</html>
